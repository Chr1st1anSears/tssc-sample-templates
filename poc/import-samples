SCRIPTDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )" 
ROOT_DIR=$(realpath $SCRIPTDIR/..)

REPO=$1
DIRNAME=$(basename $REPO) 
mkdir -p samples 
if [ -d samples/$DIRNAME ]; then
    (cd samples/$DIRNAME; git pull 2>&1 > /dev/null)
else 
    (cd samples;  git clone $REPO 2>&1 > /dev/null)
fi
 
APP_NAME=$(yq ".metadata.name" samples/$DIRNAME/devfile.yaml)

DOCKERFILE=$(yq '.components[] | select(.name == "image-build").image.dockerfile.uri' samples/$DIRNAME/devfile.yaml)
BUILDCONTEXT=$(yq '.components[] | select(.name == "image-build").image.dockerfile.buildContext' samples/$DIRNAME/devfile.yaml)

# yq ".components[].image.dockerfile.uri" samples/$DIRNAME/devfile.yaml  
# yq ".components[].image.dockerfile.buildContext" samples/$DIRNAME/devfile.yaml  

echo $APP_NAME
echo $DOCKERFILE
echo $BUILDCONTEXT 

rm -rf templates/$DIRNAME
mkdir -p templates/$DIRNAME 
cp -r samples/$DIRNAME templates/$DIRNAME/content   
cp $ROOT_DIR/templates/tekton/docker-build/.tekton  templates/$DIRNAME/content/.tekton
cp $ROOT_DIR/templates/backstage/template.yaml samples/$DIRNAME